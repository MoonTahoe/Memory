function EventCaller(){this.subscribers={}}function MemoryGame(a,b){this.table=a,this.deck=new Deck,this.MemoryItems=["!","@","#","$","%","&","*","+","=","?"],this.FaceUpCards=[],this.debug=b||!1;for(var c=0;c<this.MemoryItems.length;c++)this.deck.GameCards.push(new Card(this.MemoryItems[c],document.createElement("div"))),this.deck.GameCards.push(new Card(this.MemoryItems[c],document.createElement("div")));Object.defineProperty(this,"gameCards",{get:function(){return this.deck.GameCards}})}function checkCards(a,b){2===a.length&&(a[0].FaceValue===a[1].FaceValue?(b.emit("match",a[1].FaceValue),setTimeout(function(){a[0].discard(),a[1].discard(),a.pop(),a.pop(),b.table.children.length||b.emit("end")},1500)):setTimeout(function(){a[0].flip(),a[1].flip(),a.pop(),a.pop()},1500))}function checkRequired(a,b){if(!a)throw new Error("Messenger constructor requires a DOM element as an argument.");if(!(a instanceof HTMLElement))throw new Error("Messenger DOM element argument not a HTMLElement.");if(b&&"string"!=typeof b)throw new Error("Messenger Message not a string.")}function Messenger(a,b){this.el=a,this.message="",checkRequired(a,b),b&&(this.el.innerHTML=b,this.message=b)}function Timer(a){this.interval=null,this.intervalTime=a||100,this.time=this.intervalTime,this.ticks=0}var Card=function(a,b){this.faceUp=!1,this.FaceValue=a,this.cardElement=b};Card.prototype.flip=function(){this.faceUp?(this.cardElement.removeAttribute("class"),this.cardElement.innerHTML=""):(this.cardElement.setAttribute("class","selected"),this.cardElement.innerHTML="<span>"+this.FaceValue+"</span>"),this.faceUp=!this.faceUp},Card.prototype.discard=function(){this.cardElement.parentNode.removeChild(this.cardElement)};var Deck=function(){this.GameCards=[]};Deck.prototype.getCount=function(){return this.GameCards.length},Deck.prototype.shuffle=function(){for(var a=[],b=function(){var b=Math.floor(Math.random()*a.length),c=a[b];return a.splice(b,1),c},c=this.GameCards.length,d=0;c>d;d++)a.push(this.GameCards.pop());for(d=0;c>d;d++)this.GameCards.push(b())},Deck.prototype.deal=function(){return this.GameCards.splice(0,1)},EventCaller.prototype.on=function(a,b){this.subscribers[a]||(this.subscribers[a]=[]),this.subscribers[a].push(b)},EventCaller.prototype.emit=function(a){var b=arguments;this.subscribers[a]&&this.subscribers[a].forEach(function(a){b.length>1?a(b[1],b[2],b[3]):a()})},EventCaller.prototype.remove=function(a){this.subscribers[a]=void 0},MemoryGame.prototype=new EventCaller,MemoryGame.prototype.deal=function(a){var b=this;this.gameCards.forEach(function(a){a.faceUp&&a.flip()}),this.debug||this.deck.shuffle(),this.gameCards.forEach(function(a){a.cardElement.onclick=function(){b.FaceUpCards.length<2&&(a.flip(),b.FaceUpCards.push(a),checkCards(b.FaceUpCards,b))},b.table.appendChild(a.cardElement)}),this.emit("deal",this.table,this.debug),a&&a(this.table)},Messenger.prototype.update=function(a){this.message=a,this.el.innerHTML=a},Timer.prototype.start=function(){var a=this;this.interval=setInterval(function(){a.time+=a.intervalTime},this.intervalTime)},Timer.prototype.stop=function(){clearInterval(this.interval)},Timer.prototype.reset=function(){this.stop(),this.time=0},describe("Game Card",function(){beforeEach(function(){this.card=new Card("Ace",document.createElement("div"))}),afterEach(function(){this.card=null}),it("can be created with a value",function(){expect(this.card).toBeDefined(),expect(this.card.FaceValue).toBe("Ace")}),it("has a DOM element for the card",function(){expect(this.card.cardElement).toBeTruthy(),expect(this.card.cardElement.nodeName).toBe("DIV"),expect(this.card.cardElement.className).toBeFalsy(),expect(this.card.cardElement.innerHTML).toBeFalsy()}),it("can flip",function(){expect(this.card.faceUp).toBeFalsy(),expect(this.card.cardElement.className).toBeFalsy(),expect(this.card.cardElement.innerHTML).toBeFalsy(),this.card.flip(),expect(this.card.faceUp).toBeTruthy(),expect(this.card.cardElement.className).toEqual("selected"),expect(this.card.cardElement.innerHTML).toBe("<span>Ace</span>"),this.card.flip(),expect(this.card.faceUp).toBeFalsy(),expect(this.card.cardElement.className).toBeFalsy(),expect(this.card.cardElement.innerHTML).toBeFalsy()}),it("can be discarded",function(){var a=document.createElement("section"),b=a.children.length;a.appendChild(this.card.cardElement),expect(a.children.length).toEqual(b+1),this.card.discard(),expect(a.children.length).toEqual(b)})}),describe("Game Deck",function(){beforeEach(function(){this.deck=new Deck;var a=this.deck;this.sampleCards=["Ace","King","Queen","Jack"],this.sampleCards.forEach(function(b){a.GameCards.push(new Card(b))})}),it("can be created",function(){expect(this.deck).toBeDefined()}),it("can hold cards",function(){var a=this.deck;expect(a.GameCards.length).toEqual(this.sampleCards.length),this.sampleCards.forEach(function(b,c){expect(a.GameCards[c].FaceValue.toString()).toEqual(b)})}),it("can shuffle",function(){this.deck.shuffle();var a=[];this.deck.GameCards.forEach(function(b){a.push(b.FaceValue)}),expect(a).not.toEqual(this.sampleCards)})}),describe("Event Caller",function(){beforeEach(function(){this.emitter=new EventCaller;var a=function(){this.name="Some Object"};a.prototype=new EventCaller,this.myObj=new a}),it("can be created",function(){expect(this.emitter).toBeDefined(),expect(this.emitter.on).toBeDefined(),expect(this.emitter.emit).toBeDefined(),expect(this.emitter.remove).toBeDefined()}),it("can be inherited",function(){expect(this.myObj.on).toBeDefined(),expect(this.myObj.emit).toBeDefined(),expect(this.myObj.remove).toBeDefined()}),it("should add subscribers",function(){this.emitter.on("custom",function(){}),expect(this.emitter.subscribers.custom).toBeDefined(),expect(this.emitter.subscribers.custom.length).toEqual(1)}),it("should remove subscribers",function(){this.emitter.on("custom",function(){}),this.emitter.remove("custom"),expect(this.emitter.subscribers.custom).not.toBeDefined()}),it("should emit events",function(){var a;this.emitter.on("custom",function(){a=!0}),this.emitter.emit("custom"),expect(a).toBe(!0)}),it("should emit with arguments",function(){this.emitter.on("customWithArgs",function(a,b,c){expect(a).toBe(1),expect(b).toBe(2),expect(c).toBe("shoe")}),this.emitter.emit("customWithArgs",1,2,"shoe")})}),describe("Memory Game",function(){describe("Starting the Game",function(){beforeEach(function(){this.section=document.createElement("section"),this.game=new MemoryGame(this.section)}),afterEach(function(){this.game.remove("deal"),this.game=null}),it("should be able to create a new game",function(){expect(this.game).toBeDefined(),expect(this.game.on).toBeDefined(),expect(this.game.remove).toBeDefined(),expect(this.game.emit).toBeDefined(),expect(this.game.deal).toBeDefined(),expect(this.game.table).toEqual(this.section),expect(this.game.gameCards.length).toEqual(20),this.game.gameCards.forEach(function(a){expect(a.faceUp).toBe(!1)})}),it("should deal the game cards to a DOM Element",function(a){this.game.deal(function(b){expect(b.children.length).toEqual(20),a()})}),it("should emit 'deal' event",function(){this.game.on("deal",function(a,b){expect(a).toBeDefined(),expect(a.children.length).toEqual(20),expect(b).toBe(!1)}),this.game.deal()}),it("should deal shuffled cards",function(){var a=this.game.gameCards,b=[];a.forEach(function(a){b.push(a)}),this.game.deal(function(){expect(a).not.toEqual(b)})}),it("should be able to create a game in debug mode",function(a){var b=new MemoryGame(this.section,!0),c=[];b.gameCards.forEach(function(a){c.push(a)}),expect(b.debug).toBe(!0),b.on("deal",function(d,e){expect(e).toBe(!0),expect(b.gameCards).toEqual(c),a()}),b.deal()})}),describe("Playing the Game",function(){beforeEach(function(a){this.section=document.createElement("section"),this.game=new MemoryGame(this.section,!0),this.game.deal(function(){a()})}),afterEach(function(){this.game.remove("match"),this.game=null}),it("should be able to flip over one card",function(){var a=this.section.firstChild;a.onclick&&a.onclick(),this.game.gameCards.forEach(function(a,b){0===b?(expect(a.faceUp).toBe(!0),expect(a.cardElement.innerHTML).toBe("<span>!</span>"),expect(a.cardElement.getAttribute("class")).toBe("selected")):(expect(a.faceUp).toBe(!1),expect(a.cardElement.innerHTML).toBeFalsy(),expect(a.cardElement.getAttribute("class")).toBeFalsy())})}),describe("flipping over two cards",function(){it("should emit 'match' event",function(a){var b=this.section,c=b.children[0],d=b.children[1];this.game.on("match",function(b){expect(b).toBe("!"),a()}),c.onclick&&c.onclick(),d.onclick&&d.onclick()}),it("should flip over mismatched cards",function(a){var b=this.section,c=b.children[0],d=b.children[3];c.onclick&&c.onclick(),d.onclick&&d.onclick(),expect(c.innerHTML).toBe("<span>!</span>"),expect(d.innerHTML).toBe("<span>@</span>"),expect(c.getAttribute("class")).toBe("selected"),expect(d.getAttribute("class")).toBe("selected"),setTimeout(function(){expect(b.children.length).toEqual(20),expect(c.innerHTML).toBeFalsy(),expect(d.innerHTML).toBeFalsy(),expect(c.getAttribute("class")).toBeFalsy(),expect(d.getAttribute("class")).toBeFalsy(),a()},2e3)}),it("should remove matched cards",function(a){var b=this.section,c=b.children[0],d=b.children[1];this.game.on("match",function(){setTimeout(function(){expect(b.children.length).toEqual(18),a()},2e3)}),c.onclick&&c.onclick(),d.onclick&&d.onclick()}),it("should not allow a third card flip",function(){var a=this.section,b=a.children[0],c=a.children[2],d=a.children[4];b.onclick&&b.onclick(),c.onclick&&c.onclick(),d.onclick&&d.onclick(),expect(b.innerHTML).toBe("<span>!</span>"),expect(c.innerHTML).toBe("<span>@</span>"),expect(d.innerHTML).toBeFalsy(),expect(b.getAttribute("class")).toBe("selected"),expect(c.getAttribute("class")).toBe("selected"),expect(d.getAttribute("class")).toBeFalsy()})})}),describe("Ending the Game",function(){beforeEach(function(a){jasmine.DEFAULT_TIMEOUT_INTERVAL=6e4,this.section=document.createElement("section"),this.game=new MemoryGame(this.section,!0),this.game.deal(function(){a()})}),afterEach(function(){this.game.remove("end"),this.game=null,jasmine.DEFAULT_TIMEOUT_INTERVAL=5e3}),it("should emit 'end' event",function(a){function b(){c.children[0].onclick&&c.children[0].onclick(),c.children[1].onclick&&c.children[1].onclick(),c.children.length&&setTimeout(b,2e3)}var c=this.section;this.game.on("end",function(){expect(!0).toBe(!0),a()}),b()})})}),describe("Messenger",function(){var a,b;beforeEach(function(){b=document.createElement("p"),a=new Messenger(b)}),it("can be created",function(){expect(a).toBeDefined(),expect(a.el).toBe(b)}),it("can be created with a default message",function(){a=new Messenger(b,"Initial Message"),expect(a.message).toBe("Initial Message"),expect(b.innerHTML).toBe("Initial Message")}),it("can update the message",function(){a.update("New Message"),expect(a.message).toBe("New Message"),expect(b.innerHTML).toBe("New Message")}),describe("Errors",function(){var c;beforeEach(function(){c=null}),it("should throw an error when created without DOM element",function(){try{a=new Messenger}catch(b){c=b}expect(c).toBeDefined(),expect(c.message).toEqual("Messenger constructor requires a DOM element as an argument.")}),it("should throw an error when the first argument is not a HTMLElement",function(){try{a=new Messenger({})}catch(b){c=b}expect(c).toBeDefined(),expect(c.message).toEqual("Messenger DOM element argument not a HTMLElement.")}),it("should throw an error when the second argument is not a string",function(){try{a=new Messenger(b,33)}catch(d){c=d}expect(c).toBeDefined(),expect(c.message).toEqual("Messenger Message not a string.")})})}),describe("Timer",function(){beforeEach(function(){this.timer=new Timer}),afterEach(function(){this.timer.stop()}),it("should start",function(a){var b=this.timer,c=b.time;b.start(),setTimeout(function(){expect(typeof b.time).toBe("number"),expect(b.time).not.toEqual(c),a()},1e3)}),it("should stop",function(a){var b=new Timer(200),c=b.time;b.start(),setTimeout(function(){expect(b.time).not.toEqual(c),expect(b.time).toEqual(600),a()},600)})});